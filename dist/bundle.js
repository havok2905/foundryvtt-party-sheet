(()=>{"use strict";const e="foundryvtt-party-sheet",t="modules/foundryvtt-party-sheet/templates/party-sheet.hbs";class a extends ActorSheet{itemClassName;itemCreateClassName;itemCreateIconClassName;itemDeleteClassName;itemDeleteIconClassName;itemEditClassName;itemEditIconClassName;itemImageClassName;itemNameClassName;itemNameHeaderClassName;itemSummaryClassName;itemSummaryOpenClassName;constructor(e,t){super(e,t),this.itemClassName="item",this.itemCreateClassName="item-create",this.itemCreateIconClassName="item-create-icon",this.itemDeleteClassName="item-delete",this.itemDeleteIconClassName="item-delete-icon",this.itemEditClassName="item-edit",this.itemEditIconClassName="item-edit-icon",this.itemImageClassName="item-image",this.itemNameClassName="item-name",this.itemNameHeaderClassName="item-name-header",this.itemSummaryClassName="item-summary",this.itemSummaryOpenClassName="item-summary-open"}get template(){return t}static get defaultOptions(){const e=super.defaultOptions;return mergeObject(e,{classes:["actor dnd5e npc npc-sheet sheet"]}),e}handleItemCreateClick(e){if(!e.classList.contains(this.itemCreateClassName)&&!e.classList.contains(this.itemCreateIconClassName))return;let t;t=e.classList.contains(this.itemCreateIconClassName)?e.parentElement:e;const a=t?.dataset.name,s=t?.dataset.type;this.actor.createEmbeddedDocuments("Item",[{name:a,type:s}])}handleItemDeleteClick(e){if(!e.classList.contains(this.itemDeleteClassName)&&!e.classList.contains(this.itemDeleteIconClassName))return;let t;t=e.classList.contains(this.itemDeleteIconClassName)?e.parentElement:e;const a=t?.dataset.itemId??"";this.actor.items.get(a)?.delete()}handleItemEditClick(e){if(!e.classList.contains(this.itemEditClassName)&&!e.classList.contains(this.itemEditIconClassName))return;let t;t=e.classList.contains(this.itemEditIconClassName)?e.parentElement:e;const a=t?.dataset.itemId??"";this.actor.items.get(a)?.sheet?.render(!0)}handleItemImageClick(e){if(!e.classList.contains(this.itemImageClassName))return;const t=e.dataset.itemId??"";this.actor.items.get(t)?.use()}handleItemNameClick(e){if(!e.classList.contains(this.itemNameClassName)&&!e.classList.contains(this.itemNameHeaderClassName))return;const t=e.parentElement?.classList.contains(this.itemClassName);if(e.classList.contains(this.itemImageClassName)&&!t)return;let a;a=e.classList.contains(this.itemNameHeaderClassName)?e.parentElement:e;const s=a.parentElement.getElementsByClassName(this.itemSummaryClassName)[0];s.classList.contains(this.itemSummaryOpenClassName)?s.classList.remove(this.itemSummaryOpenClassName):s.classList.add(this.itemSummaryOpenClassName)}activateListeners(e){e.on("click",(e=>{const t=e.target;this.handleItemCreateClick(t),this.handleItemDeleteClick(t),this.handleItemEditClick(t),this.handleItemImageClick(t),this.handleItemNameClick(t)}))}getData(){const t=super.getData(),a=game.actors.filter((e=>e.hasPlayerOwner)),s=this.actor.getFlag(e,"cp")??0,i=this.actor.getFlag(e,"ep")??0,m=this.actor.getFlag(e,"gp")??0,n=this.actor.getFlag(e,"location")??"",l=this.actor.getFlag(e,"pp")??0,o=this.actor.getFlag(e,"reputationNameA")??"",r=this.actor.getFlag(e,"reputationNameB")??"",c=this.actor.getFlag(e,"reputationNameC")??"",p=this.actor.getFlag(e,"reputationNameD")??"",u=this.actor.getFlag(e,"reputationNameE")??"",h=this.actor.getFlag(e,"reputationValueA")??0,N=this.actor.getFlag(e,"reputationValueB")??0,C=this.actor.getFlag(e,"reputationValueC")??0,g=this.actor.getFlag(e,"reputationValueD")??0,d=this.actor.getFlag(e,"reputationValueE")??0,I=this.actor.getFlag(e,"sp")??0,y=this.actor.items.filter((e=>"consumable"===e.type)),E=this.actor.items.filter((e=>"backpack"===e.type)),D=this.actor.items.filter((e=>"equipment"===e.type)),L=this.actor.items.filter((e=>"loot"===e.type)),V=this.actor.items.filter((e=>"tool"===e.type));return{...t,cp:s,ep:i,gp:m,items:[{name:"Weapons",newItemName:"New Weapon",type:"weapon",collection:this.actor.items.filter((e=>"weapon"===e.type))},{name:"Equipment",newItemName:"New Equipment",type:"equipment",collection:D},{name:"Consumables",newItemName:"New Consumable",type:"consumable",collection:y},{name:"Tools",newItemName:"New Tool",type:"tool",collection:V},{name:"Containers",newItemName:"New Container",type:"backpack",collection:E},{name:"Loot",newItemName:"New Loot",type:"loot",collection:L}],location:n,playerCharacters:a,pp:l,reputationNameA:o,reputationNameB:r,reputationNameC:c,reputationNameD:p,reputationNameE:u,reputationValueA:h,reputationValueB:N,reputationValueC:C,reputationValueD:g,reputationValueE:d,sp:I}}async _updateObject(t,a){const{cp:s,ep:i,gp:m,location:n,name:l,pp:o,reputationNameA:r,reputationNameB:c,reputationNameC:p,reputationNameD:u,reputationNameE:h,reputationValueA:N,reputationValueB:C,reputationValueC:g,reputationValueD:d,reputationValueE:I,sp:y}=a,E={name:l},D={flags:{[e]:{cp:s,ep:i,gp:m,location:n,pp:o,reputationNameA:r,reputationNameB:c,reputationNameC:p,reputationNameD:u,reputationNameE:h,reputationValueA:N,reputationValueB:C,reputationValueC:g,reputationValueD:d,reputationValueE:I,sp:y}}};await this.object.update(E),await this.actor.update(D)}}Hooks.on("init",(async()=>{await loadTemplates([t]),Actors.registerSheet("party-sheet",a,{label:"Party",makeDefault:!1,types:["npc"]})}))})();